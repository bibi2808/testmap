<html>

<head>
    <meta charset=utf-8 />
    <title>Simple FeatureLayer</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet from CDN-->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" type="text/css"
        href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <!-- Load Esri Leaflet from CDN -->
    <script src="http://cdn-geoweb.s3.amazonaws.com/esri-leaflet/1.0.0-rc.5/esri-leaflet.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
            height: 880px;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <script>

        let factor;
        let markers = [];
        iconInitWidth = 32;
        iconInitHeight = 32;
        var mymap = L.map('map').setView([43.0618, 141.3545], 7);
        //New class of icons
        const MyIcon = L.Icon.extend({
            options: {
                iconSize: new L.Point(iconInitWidth, iconInitHeight) //Define your iconInitWidth and iconInitHeight before
            },
        });

        /*------------ Functions - Callbacks ----------------*/
        //Small function to keep the factor up to date with the current zoom
        function updateFactor() {
            let currentZoom = mymap.getZoom();
            factor = Math.pow(currentZoom / mymap.options.zoom, 5);
        };
        updateFactor();

        //Create a new marker
        function makeMarker(e) {
            const newX = Math.round(iconInitWidth * factor);
            const newY = newX * iconInitHeight / iconInitWidth;

            const newMarker = new L.Marker(new L.LatLng(e.latlng.lat, e.latlng.lng), {
                icon: new MyIcon({ iconSize: new L.Point(newX, newY) })
            }).addTo(mymap);

            markers[markers.length] = newMarker;
        }

        //Update the marker
        function resize(e) {
            updateFactor();

            for (const marker of markers) {

                const newX = Math.round(iconInitWidth * factor);
                const newY = newX * iconInitHeight / iconInitWidth;

                marker.setIcon(new MyIcon({ iconSize: new L.Point(newX, newY) }));
            }
        }

        /*------------ Event listeners ----------------*/
        mymap.addEventListener('click', makeMarker);
        mymap.on('zoom', resize);

    </script>
</body>

</html>